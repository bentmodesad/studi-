<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Album Astronomi Modern - Deteksi Otomatis</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --dark-bg: #0f172a;
            --darker-bg: #0a0f1f;
            --card-bg: #1e293b;
            --light-text: #f1f5f9;
            --muted-text: #94a3b8;
            --accent: #06b6d4;
            --success: #10b981;
            --border: #334155;
        }

        body {
            background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 50%, var(--darker-bg) 100%);
            color: var(--light-text);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 24px;
            margin-bottom: 40px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 16px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 1.3rem;
            color: var(--muted-text);
            max-width: 900px;
            margin: 0 auto;
            line-height: 1.8;
        }

        .highlight {
            background: rgba(99, 102, 241, 0.2);
            padding: 4px 12px;
            border-radius: 6px;
            color: var(--primary);
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1100px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            color: var(--light-text);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .card-title i {
            color: var(--primary);
            font-size: 1.8rem;
        }

        .upload-section {
            text-align: center;
        }

        .upload-area {
            padding: 50px 30px;
            border-radius: 16px;
            background: rgba(15, 23, 42, 0.6);
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            border: 2px dashed var(--border);
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: rgba(15, 23, 42, 0.8);
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.2);
        }

        .upload-area i {
            font-size: 5rem;
            color: var(--primary);
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .upload-area h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--light-text);
        }

        .upload-area p {
            color: var(--muted-text);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        #fileInput {
            display: none;
        }

        .quick-tips {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .tip {
            background: rgba(99, 102, 241, 0.1);
            padding: 12px 18px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            border: 1px solid rgba(99, 102, 241, 0.2);
            transition: all 0.2s;
        }

        .tip:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: translateY(-2px);
        }

        .tip i {
            color: var(--primary);
        }

        .auto-detect-section {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .path-display {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            color: var(--light-text);
            word-break: break-all;
        }

        .detect-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .detect-info div {
            text-align: center;
        }

        .detect-info .number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            line-height: 1;
        }

        .detect-info .label {
            font-size: 0.95rem;
            color: var(--muted-text);
            margin-top: 8px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 32px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3);
        }

        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(99, 102, 241, 0.4);
            background: linear-gradient(90deg, var(--primary-dark), var(--primary));
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(90deg, var(--card-bg), #2d3748);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: linear-gradient(90deg, #2d3748, var(--card-bg));
        }

        .btn-success {
            background: linear-gradient(90deg, var(--success), #0da271);
        }

        .btn-success:hover {
            background: linear-gradient(90deg, #0da271, var(--success));
        }

        .album-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .photo-item {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            height: 300px;
            background: var(--card-bg);
            border: 1px solid var(--border);
        }

        .photo-item:hover {
            transform: translateY(-15px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border-color: var(--primary);
        }

        .photo-item.dragging {
            opacity: 0.8;
            transform: scale(1.05) rotate(5deg);
            z-index: 100;
            box-shadow: 0 0 40px rgba(99, 102, 241, 0.6);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.8s ease;
        }

        .photo-item:hover img {
            transform: scale(1.1);
        }

        .photo-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(15, 23, 42, 0.95), transparent);
            padding: 25px 20px 20px;
            transform: translateY(5px);
            transition: transform 0.4s ease;
        }

        .photo-item:hover .photo-info {
            transform: translateY(0);
        }

        .photo-title {
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: 8px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .photo-desc {
            font-size: 1rem;
            color: var(--muted-text);
            line-height: 1.5;
        }

        .photo-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            font-size: 0.85rem;
            color: #a5b4cb;
        }

        .drag-handle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(30, 41, 59, 0.9);
            color: var(--muted-text);
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            z-index: 10;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .drag-handle:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .photo-count {
            text-align: center;
            font-size: 1.3rem;
            color: var(--light-text);
            margin-top: 20px;
            padding: 25px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .loading {
            grid-column: 1 / -1;
            text-align: center;
            padding: 80px 20px;
        }

        .loading-spinner {
            border: 6px solid rgba(99, 102, 241, 0.1);
            border-radius: 50%;
            border-top: 6px solid var(--primary);
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-album {
            grid-column: 1 / -1;
            text-align: center;
            padding: 80px 20px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 20px;
            border: 2px dashed var(--border);
        }

        .empty-album i {
            font-size: 5rem;
            color: var(--muted-text);
            margin-bottom: 25px;
            opacity: 0.7;
        }

        .empty-album h3 {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--light-text);
        }

        .empty-album p {
            color: var(--muted-text);
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
        }

        footer {
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            color: var(--muted-text);
            font-size: 1rem;
            border-top: 1px solid var(--border);
        }

        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 18px 28px;
            border-radius: 14px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            font-weight: 600;
            animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), fadeOut 0.4s ease 2.6s;
            animation-fill-mode: forwards;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin-top: 12px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            width: 0%;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.8rem;
            }
            
            .dashboard {
                gap: 20px;
            }
            
            .card {
                padding: 25px;
            }
            
            .album-container {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 20px;
            }
            
            .photo-item {
                height: 280px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 350px;
                justify-content: center;
            }
            
            .notification {
                max-width: 90%;
                left: 5%;
                right: 5%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-stars"></i> Album Astronomi Modern</h1>
            <p class="subtitle">Upload foto secara manual atau biarkan sistem mendeteksi gambar dari folder <span class="highlight">src/</span> secara otomatis</p>
        </header>

        <div class="dashboard">
            <div class="card upload-section">
                <div class="card-title">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>Upload Manual</span>
                </div>
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-images"></i>
                    <h3>Upload Foto Astronomi</h3>
                    <p>Pilih semua foto sekaligus dari folder mana saja</p>
                    <p><strong>Format yang didukung:</strong> JPG, PNG, WebP, GIF</p>
                    <input type="file" id="fileInput" accept="image/*" multiple>
                    <button class="btn" id="selectFilesBtn" style="margin-top: 20px;">
                        <i class="fas fa-folder-open"></i> Pilih Foto
                    </button>
                </div>
                
                <div class="quick-tips">
                    <div class="tip">
                        <i class="fas fa-mouse-pointer"></i> Ctrl+A untuk pilih semua
                    </div>
                    <div class="tip">
                        <i class="fas fa-hand-pointer"></i> Ctrl+Click untuk pilih beberapa
                    </div>
                    <div class="tip">
                        <i class="fas fa-drag-drop"></i> Drag & Drop langsung
                    </div>
                </div>
            </div>

            <div class="card auto-detect-section">
                <div class="card-title">
                    <i class="fas fa-robot"></i>
                    <span>Deteksi Otomatis</span>
                </div>
                <p style="color: var(--muted-text); margin-bottom: 20px; line-height: 1.7;">
                    Sistem akan mencoba mendeteksi gambar dari folder <span class="highlight">src/</span> secara otomatis.
                    Gambar dengan nama seperti <span class="highlight">src/1.jpg</span>, <span class="highlight">src/2.jpg</span>, dll. akan terdeteksi.
                </p>
                
                <div class="path-display">
                    <i class="fas fa-folder"></i> Path yang dipindai: <strong>src/*.jpg, src/*.png, src/*.jpeg, src/*.webp, src/*.gif</strong>
                </div>
                
                <div class="detect-info">
                    <div>
                        <div class="number" id="detectedCount">0</div>
                        <div class="label">Terdeteksi</div>
                    </div>
                    <div>
                        <div class="number" id="loadedCount">0</div>
                        <div class="label">Dimuat</div>
                    </div>
                    <div>
                        <div class="number" id="totalCount">0</div>
                        <div class="label">Total di Album</div>
                    </div>
                </div>
                
                <button class="btn btn-success" id="detectBtn">
                    <i class="fas fa-search"></i> Deteksi Gambar di src/
                </button>
            </div>
        </div>

        <div class="controls">
            <button class="btn" id="shuffleBtn" disabled>
                <i class="fas fa-random"></i> Acak Posisi
            </button>
            <button class="btn btn-secondary" id="clearBtn" disabled>
                <i class="fas fa-trash"></i> Hapus Semua
            </button>
            <button class="btn" id="downloadBtn" disabled>
                <i class="fas fa-download"></i> Simpan Album
            </button>
        </div>

        <div class="album-container" id="albumContainer">
            <div class="empty-album">
                <i class="fas fa-galaxy"></i>
                <h3>Album Kosong</h3>
                <p>Upload foto secara manual atau gunakan fitur deteksi otomatis untuk memulai</p>
            </div>
        </div>

        <div class="photo-count" id="photoCount">
            <i class="fas fa-images"></i> 
            <strong>0 foto</strong> di album astronomi
            <div style="font-size: 1rem; margin-top: 10px; color: var(--muted-text);">
                Seret dan lepas foto untuk mengatur ulang urutannya
            </div>
        </div>

        <footer>
            <p>Album Astronomi Modern &copy; 2023 - Deteksi otomatis gambar dari folder src/</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                <i class="fas fa-info-circle"></i> Sistem akan mencoba mendeteksi gambar dengan pola: src/1.jpg, src/2.jpg, src/3.jpg, dst.
            </p>
        </footer>
    </div>

    <script>
        // Variabel global
        let astronomicalPhotos = [];
        let draggedItem = null;
        
        // Daftar nama astronomi untuk judul foto
        const astronomyNames = [
            "Galaksi Bimasakti", "Nebula Orion", "Planet Saturnus", "Galaksi Andromeda",
            "Nebula Helix", "Aurora Borealis", "Bulan Purnama", "Nebula Carina",
            "Komet Neowise", "Planet Jupiter", "Nebula Kepiting", "Supernova",
            "Lubang Hitam", "Galaksi Sombrero", "Nebula Kupu-kupu", "Planet Mars",
            "Eklips Matahari", "Gugus Bintang", "Nebula Roset", "Galaksi Pusaran",
            "Nebula Lagoon", "Bintang Neutron", "Sistem Bintang Ganda", "Planet Venus",
            "Nebula Katak", "Galaksi Roda Biru", "Nebula Kepala Kuda", "Planet Uranus"
        ];

        // Daftar deskripsi astronomi
        const astronomyDescriptions = [
            "Keindahan alam semesta yang tak terbatas", "Fenomena luar angkasa yang menakjubkan",
            "Dokumentasi astronomi yang langka", "Potret indah dari jagad raya",
            "Eksplorasi visual alam semesta", "Momentum langit malam yang spektakuler",
            "Keajaiban kosmos yang abadi", "Pemandangan dari luar angkasa",
            "Fenomena langit yang jarang terlihat", "Keindahan galaksi yang jauh",
            "Bintang-bintang bersinar di kegelapan", "Misteri alam semesta yang terungkap",
            "Keagungan ciptaan di angkasa", "Dokumentasi eksplorasi antariksa",
            "Keindahan yang tak terjangkau kata-kata", "Potret kosmos dari berbagai sudut",
            "Keajaiban alam semesta dalam satu frame", "Pesona luar angkasa yang memukau",
            "Momentum langka di alam semesta", "Visualisasi data astronomi yang indah"
        ];

        // Fungsi untuk mendapatkan nama file tanpa ekstensi
        function getFileNameWithoutExtension(filename) {
            return filename.replace(/\.[^/.]+$/, "").replace(/[-_]/g, " ");
        }

        // Fungsi untuk menghasilkan nama dan deskripsi untuk foto
        function getAstronomyInfo(filename, index) {
            const nameFromFile = getFileNameWithoutExtension(filename);
            
            let displayName;
            if (nameFromFile.length > 3 && nameFromFile !== filename.replace(/\.[^/.]+$/, "")) {
                displayName = nameFromFile.charAt(0).toUpperCase() + nameFromFile.slice(1);
            } else {
                displayName = astronomyNames[index % astronomyNames.length] || astronomyNames[Math.floor(Math.random() * astronomyNames.length)];
            }
            
            const descIndex = Math.floor(Math.random() * astronomyDescriptions.length);
            
            return {
                title: displayName,
                desc: astronomyDescriptions[descIndex]
            };
        }

        // Fungsi untuk memuat foto ke album
        function loadPhotos() {
            const albumContainer = document.getElementById('albumContainer');
            const photoCount = document.getElementById('photoCount');
            const shuffleBtn = document.getElementById('shuffleBtn');
            const clearBtn = document.getElementById('clearBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const totalCount = document.getElementById('totalCount');
            const loadedCount = document.getElementById('loadedCount');
            
            // Kosongkan kontainer
            albumContainer.innerHTML = '';
            
            // Jika tidak ada foto
            if (astronomicalPhotos.length === 0) {
                albumContainer.innerHTML = `
                    <div class="empty-album">
                        <i class="fas fa-galaxy"></i>
                        <h3>Album Kosong</h3>
                        <p>Upload foto secara manual atau gunakan fitur deteksi otomatis untuk memulai</p>
                    </div>
                `;
                photoCount.innerHTML = `
                    <i class="fas fa-images"></i> 
                    <strong>0 foto</strong> di album astronomi
                    <div style="font-size: 1rem; margin-top: 10px; color: #94a3b8;">
                        Seret dan lepas foto untuk mengatur ulang urutannya
                    </div>
                `;
                
                // Nonaktifkan tombol
                shuffleBtn.disabled = true;
                clearBtn.disabled = true;
                downloadBtn.disabled = true;
                
                // Update counters
                totalCount.textContent = '0';
                loadedCount.textContent = '0';
                return;
            }
            
            // Aktifkan tombol
            shuffleBtn.disabled = false;
            clearBtn.disabled = false;
            downloadBtn.disabled = false;
            
            // Tambahkan setiap foto ke album
            astronomicalPhotos.forEach((photo, index) => {
                const photoElement = document.createElement('div');
                photoElement.className = 'photo-item';
                photoElement.setAttribute('data-id', photo.id);
                photoElement.setAttribute('draggable', 'true');
                
                photoElement.innerHTML = `
                    <div class="drag-handle" title="Seret untuk mengatur ulang">
                        <i class="fas fa-arrows-alt"></i>
                    </div>
                    <img src="${photo.src}" alt="${photo.title}" loading="lazy">
                    <div class="photo-info">
                        <div class="photo-title">
                            <i class="fas fa-star"></i> ${photo.title}
                        </div>
                        <div class="photo-desc">${photo.desc}</div>
                        <div class="photo-meta">
                            <div><i class="fas fa-file-image"></i> ${photo.filename}</div>
                            <div><i class="fas fa-hashtag"></i> ${photo.id}</div>
                        </div>
                    </div>
                `;
                
                albumContainer.appendChild(photoElement);
            });
            
            // Update jumlah foto
            photoCount.innerHTML = `
                <i class="fas fa-images"></i> 
                <strong>${astronomicalPhotos.length} foto</strong> di album astronomi
                <div style="font-size: 1rem; margin-top: 10px; color: #94a3b8;">
                    Seret dan lepas foto untuk mengatur ulang urutannya
                </div>
            `;
            
            // Update counters
            totalCount.textContent = astronomicalPhotos.length;
            loadedCount.textContent = astronomicalPhotos.filter(p => p.loaded).length;
            
            // Tambahkan event listeners untuk drag & drop
            setupDragAndDrop();
        }

        // Fungsi untuk menyiapkan drag & drop
        function setupDragAndDrop() {
            const photoItems = document.querySelectorAll('.photo-item');
            const albumContainer = document.getElementById('albumContainer');
            
            photoItems.forEach(item => {
                // Event saat mulai menyeret
                item.addEventListener('dragstart', function(e) {
                    draggedItem = this;
                    this.classList.add('dragging');
                    
                    // Atur data transfer untuk drag & drop
                    e.dataTransfer.setData('text/plain', this.getAttribute('data-id'));
                    e.dataTransfer.effectAllowed = 'move';
                });
                
                // Event saat selesai menyeret
                item.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    draggedItem = null;
                    
                    // Update urutan array setelah drag & drop
                    updatePhotoOrder();
                });
            });
            
            // Event saat item diseret di atas kontainer
            albumContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                // Dapatkan item yang sedang di-drag dan item yang di bawahnya
                const afterElement = getDragAfterElement(albumContainer, e.clientY);
                const draggable = document.querySelector('.dragging');
                
                if (afterElement == null) {
                    albumContainer.appendChild(draggable);
                } else {
                    albumContainer.insertBefore(draggable, afterElement);
                }
            });
            
            albumContainer.addEventListener('drop', function(e) {
                e.preventDefault();
            });
        }

        // Fungsi untuk mendapatkan elemen setelah posisi drag
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.photo-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Fungsi untuk memperbarui urutan array foto
        function updatePhotoOrder() {
            const photoItems = document.querySelectorAll('.photo-item');
            const newOrder = [];
            
            photoItems.forEach(item => {
                const id = parseInt(item.getAttribute('data-id'));
                const photo = astronomicalPhotos.find(p => p.id === id);
                if (photo) {
                    newOrder.push(photo);
                }
            });
            
            astronomicalPhotos = newOrder;
            showNotification("Urutan foto telah diperbarui!", 1500);
        }

        // Fungsi untuk mengacak foto
        function shufflePhotos() {
            if (astronomicalPhotos.length === 0) return;
            
            // Acak urutan array menggunakan Fisher-Yates algorithm
            for (let i = astronomicalPhotos.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [astronomicalPhotos[i], astronomicalPhotos[j]] = [astronomicalPhotos[j], astronomicalPhotos[i]];
            }
            
            loadPhotos();
            showNotification("Foto telah diacak!");
        }

        // Fungsi untuk menghapus semua foto
        function clearAllPhotos() {
            if (astronomicalPhotos.length === 0) return;
            
            if (confirm(`Apakah Anda yakin ingin menghapus semua ${astronomicalPhotos.length} foto dari album?`)) {
                astronomicalPhotos = [];
                loadPhotos();
                showNotification("Semua foto telah dihapus dari album!");
            }
        }

        // Fungsi untuk mendeteksi gambar dari folder src/
        async function detectImagesFromSrc() {
            const detectBtn = document.getElementById('detectBtn');
            const originalText = detectBtn.innerHTML;
            
            // Tampilkan loading
            detectBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Mencari gambar...`;
            detectBtn.disabled = true;
            
            // Tampilkan notifikasi
            showNotification("Mencari gambar di folder src/...", 2000);
            
            // Simulasi pencarian gambar di folder src/
            // Catatan: Di lingkungan browser, kita tidak bisa benar-benar mengakses sistem file
            // Ini adalah simulasi untuk menunjukkan konsep
            const simulatedImages = [
                { name: "1.jpg", path: "src/1.jpg", exists: true },
                { name: "2.jpg", path: "src/2.jpg", exists: true },
                { name: "3.jpg", path: "src/3.jpg", exists: true },
                { name: "4.jpg", path: "src/4.jpg", exists: true },
                { name: "5.jpg", path: "src/5.jpg", exists: true },
                { name: "nebula.png", path: "src/nebula.png", exists: true },
                { name: "galaxy.jpeg", path: "src/galaxy.jpeg", exists: true },
                { name: "stars.webp", path: "src/stars.webp", exists: true }
            ];
            
            // Update counter terdeteksi
            document.getElementById('detectedCount').textContent = simulatedImages.length;
            
            // Tampilkan loading di album container
            const albumContainer = document.getElementById('albumContainer');
            albumContainer.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Mendeteksi ${simulatedImages.length} gambar dari folder src/...</p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="detectProgress"></div>
                    </div>
                </div>
            `;
            
            // Simulasi proses deteksi dengan progress
            let loadedImages = 0;
            
            // Untuk setiap gambar yang terdeteksi, tambahkan placeholder
            // Catatan: Di implementasi nyata, Anda akan mengambil gambar dari server/local storage
            for (let i = 0; i < simulatedImages.length; i++) {
                // Update progress bar
                const progress = ((i + 1) / simulatedImages.length) * 100;
                const progressBar = document.getElementById('detectProgress');
                if (progressBar) {
                    progressBar.style.width = `${progress}%`;
                }
                
                // Simulasi delay
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Untuk demo, gunakan gambar placeholder dari picsum.photos
                // Di implementasi nyata, Anda akan mengambil dari path yang sesuai
                const imageUrl = `https://picsum.photos/400/300?random=${i}&space`;
                const info = getAstronomyInfo(simulatedImages[i].name, i);
                
                // Cek apakah foto sudah ada di album
                const existingIndex = astronomicalPhotos.findIndex(p => p.filename === simulatedImages[i].name);
                
                if (existingIndex === -1) {
                    // Jika belum ada, tambahkan
                    const newId = astronomicalPhotos.length > 0 
                        ? Math.max(...astronomicalPhotos.map(p => p.id)) + 1 
                        : 1;
                    
                    astronomicalPhotos.push({
                        id: newId,
                        src: imageUrl,
                        filename: simulatedImages[i].name,
                        path: simulatedImages[i].path,
                        title: info.title,
                        desc: info.desc,
                        loaded: true,
                        isDetected: true
                    });
                    
                    loadedImages++;
                }
            }
            
            // Reset tombol deteksi
            detectBtn.innerHTML = originalText;
            detectBtn.disabled = false;
            
            // Muat ulang album
            loadPhotos();
            
            // Tampilkan notifikasi
            showNotification(`Berhasil memuat ${loadedImages} gambar dari folder src/!`);
            
            // Tampilkan instruksi drag & drop
            setTimeout(() => {
                if (astronomicalPhotos.length > 0) {
                    showNotification("Coba seret foto untuk mengatur ulang album!", 4000);
                }
            }, 1000);
        }

        // Fungsi untuk menangani upload file
        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const selectFilesBtn = document.getElementById('selectFilesBtn');
            const uploadArea = document.getElementById('uploadArea');
            
            // Klik tombol untuk trigger file input
            selectFilesBtn.addEventListener('click', () => {
                fileInput.click();
            });
            
            // Klik area upload untuk trigger file input
            uploadArea.addEventListener('click', (e) => {
                if (e.target !== selectFilesBtn && !selectFilesBtn.contains(e.target)) {
                    fileInput.click();
                }
            });
            
            // Drag & drop ke area upload
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.background = 'rgba(15, 23, 42, 0.9)';
                uploadArea.style.borderColor = 'var(--primary)';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.background = 'rgba(15, 23, 42, 0.6)';
                uploadArea.style.borderColor = 'var(--border)';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.background = 'rgba(15, 23, 42, 0.6)';
                uploadArea.style.borderColor = 'var(--border)';
                
                if (e.dataTransfer.files.length > 0) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileUpload(fileInput.files);
                }
            });
            
            // Ketika file dipilih
            fileInput.addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    handleFileUpload(this.files);
                }
            });
        }

        // Fungsi untuk memproses file yang diupload
        function handleFileUpload(files) {
            // Tampilkan notifikasi
            showNotification(`Mengupload ${files.length} foto...`, 2000);
            
            // Tampilkan loading
            const albumContainer = document.getElementById('albumContainer');
            albumContainer.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Memproses ${files.length} foto...</p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="uploadProgress"></div>
                    </div>
                </div>
            `;
            
            // Proses file setelah delay kecil untuk UI
            setTimeout(() => {
                let newId = astronomicalPhotos.length > 0 
                    ? Math.max(...astronomicalPhotos.map(p => p.id)) + 1 
                    : 1;
                
                let processedCount = 0;
                
                // Tambahkan setiap file yang diupload
                Array.from(files).forEach((file, index) => {
                    // Hanya proses file gambar
                    if (!file.type.match('image.*')) {
                        console.log(`File ${file.name} bukan gambar, dilewati`);
                        return;
                    }
                    
                    // Update progress bar
                    processedCount++;
                    const progress = (processedCount / files.length) * 100;
                    const progressBar = document.getElementById('uploadProgress');
                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                    
                    const fileURL = URL.createObjectURL(file);
                    const info = getAstronomyInfo(file.name, index);
                    
                    astronomicalPhotos.push({
                        id: newId + index,
                        src: fileURL,
                        filename: file.name,
                        path: `uploaded/${file.name}`,
                        title: info.title,
                        desc: info.desc,
                        file: file, // Simpan file asli untuk kebutuhan download
                        isUploaded: true,
                        loaded: true
                    });
                });
                
                // Muat ulang foto
                loadPhotos();
                
                // Reset input file
                document.getElementById('fileInput').value = '';
                
                // Tampilkan notifikasi sukses
                showNotification(`Berhasil menambahkan ${processedCount} foto ke album!`);
            }, 500);
        }

        // Fungsi untuk menyimpan album
        function saveAlbum() {
            if (astronomicalPhotos.length === 0) {
                showNotification("Tidak ada foto untuk disimpan!", 2000);
                return;
            }
            
            // Buat data album
            const albumData = {
                title: "Album Astronomi Modern",
                totalPhotos: astronomicalPhotos.length,
                created: new Date().toISOString(),
                source: "Deteksi otomatis dari folder src/ dan upload manual",
                photos: astronomicalPhotos.map(photo => ({
                    id: photo.id,
                    filename: photo.filename,
                    path: photo.path,
                    title: photo.title,
                    desc: photo.desc,
                    source: photo.isDetected ? "Detected from src/" : "Manual upload"
                }))
            };
            
            // Buat blob dan download
            const blob = new Blob([JSON.stringify(albumData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `album-astronomi-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification("Data album telah disimpan ke file JSON!");
        }

        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, duration = 3000) {
            // Hapus notifikasi sebelumnya jika ada
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // Buat elemen notifikasi
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            // Tambahkan ikon berdasarkan jenis pesan
            let icon = 'fas fa-info-circle';
            if (message.includes('Berhasil') || message.includes('sukses')) {
                icon = 'fas fa-check-circle';
            } else if (message.includes('error') || message.includes('gagal')) {
                icon = 'fas fa-exclamation-circle';
            } else if (message.includes('Mencari') || message.includes('Memproses')) {
                icon = 'fas fa-spinner fa-spin';
            }
            
            notification.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Hapus notifikasi setelah duration
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, duration);
        }

        // Inisialisasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            // Setup event listeners untuk tombol
            document.getElementById('shuffleBtn').addEventListener('click', shufflePhotos);
            document.getElementById('clearBtn').addEventListener('click', clearAllPhotos);
            document.getElementById('downloadBtn').addEventListener('click', saveAlbum);
            document.getElementById('detectBtn').addEventListener('click', detectImagesFromSrc);
            
            // Setup file upload
            setupFileUpload();
        });
    </script>
</body>
</html>
